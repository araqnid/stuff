apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'application'

mainClassName = 'org.araqnid.stuff.Main'
sourceCompatibility = 1.7
version = '0.0.' + (System.getenv("BUILD_NUMBER") ?: "0")

jar {
    manifest {
        attributes 'Implementation-Title': 'Stuff',
                   'Implementation-Version': version
    }
}

repositories {
    mavenCentral()
}

dependencies {
    compile 'com.google.guava:guava:17.0'
    compile 'com.google.inject:guice:3.0'
    compile 'com.google.inject.extensions:guice-servlet:3.0'
    compile 'com.google.inject.extensions:guice-multibindings:3.0'
    compile 'org.slf4j:slf4j-api:1.7.7'
    compile 'org.eclipse.jetty:jetty-server:8.1.15.v20140411'
    compile 'org.eclipse.jetty:jetty-servlet:8.1.15.v20140411'
    compile 'com.surftools:BeanstalkClient:1.4.6'
    compile 'com.google.code.gson:gson:2.2.4'
    //compile 'org.hibernate:hibernate-core:4.3.6.Final'
    //compile 'org.hibernate:hibernate-entitymanager:4.3.6.Final'
    compile 'org.jboss.resteasy:resteasy-guice:3.0.8.Final'
    compile 'com.lexicalscope.eventcast:eventcast:1.0.2'
    //runtime 'ch.qos.logback:logback-core:1.1.2'
    runtime 'org.slf4j:slf4j-simple:1.7.7'
    runtime 'org.postgresql:postgresql:9.3-1102-jdbc41'
    testCompile 'junit:junit:4.11'
    testCompile 'org.hamcrest:hamcrest-library:1.3'
    testCompile 'org.hamcrest:hamcrest-integration:1.3'
    testCompile 'org.mockito:mockito-core:1.9.5'
}

task runtimeDeps(dependsOn: 'processResources') {
    def metainf = new File("$buildDir/resources/main/META-INF");
    metainf.mkdirs()
    def depsFile = new File(metainf, "stuff.deps.txt");
    depsFile.text = ''
    configurations.runtime.resolvedConfiguration.resolvedArtifacts.each { artifact ->
        depsFile.text += artifact.moduleVersion.id.toString() + ' ' + artifact.type + '\n'
    }
}

jar.dependsOn(runtimeDeps)
